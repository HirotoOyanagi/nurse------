ナース・スケジューリング問題
看護婦の人数m、スケジュール日数n、勤務の種類の数w、スキルレベルやチーム構成等によるグループ、同じ勤務での組合せを避ける看護婦ペアまたはグループ、前月の勤務表が与えられ、毎日の各勤務に必要な看護婦数と各グループからの人数の上限と下限、各看護婦の各勤務に対する回数の上限と下限、それら以外の業務の日程、休日希望日、そして禁止される勤務パターン、が明らかであるとき、これらの条件の下でできるだけ希望目標が達成されるようなスケジュールを組みたい 。

《記号説明》
M={看護婦1,看護婦2,...,看護婦m}: スケジュール対象となる看護婦の集合
N={1,2,...,n}: スケジュール対象となる日の集合
W={勤務1,勤務2,...,勤務w}: 勤務の集合
R={r∣r は看護婦のグループ}
G 
r
​
 ={i∣i はグループrに所属する看護婦}, r∈R
F 
1
​
 ={(i,j,k)∣i∈M,j∈N,k∈W∣ 看護婦iのj日の勤務がすでに勤務kに決定している} 
F 
0
​
 ={(i,j,k)∣i∈M,j∈N,k∈W∣ 看護婦iのj日に対して勤務kが禁止されている} 
P 
h
​
 ={(k 
1
​
 ,k 
2
​
 ,...,k 
h
​
 )∣k 
1
​
 ,k 
2
​
 ,...,k 
h
​
 ∈W∣ 勤務 k 
1
​
 ,k 
2
​
 ,...,k 
h
​
  の連続勤務が禁止されている}, h∈{2,3,...} 
Q 
h
​
 ={(k,u,v)∣k∈W,u,v∈{0,1,2,...}∣ 勤務kには、連続するh日間にu回以上v回以下}, h∈{2,3,...} 
d 
jk
​
 ,j∈N,k∈W: j日の勤務kに必要な人数
a 
rjk
​
 ,r∈R,j∈N,k∈W: j日の勤務kに対するグループrからの人数の下限
b 
rjk
​
 ,r∈R,j∈N,k∈W: j日の勤務kに対するグループrからの人数の上限
c 
ik
​
 ,i∈M,k∈W: 看護婦iの勤務kに対する勤務回数の下限
e 
ik
​
 ,i∈M,k∈W: 看護婦iの勤務kに対する勤務回数の上限
x 
ijk
​
 ,i∈M,j∈N,k∈W: 看護婦iのj日の勤務をkにするとき値1をとり、そうでないとき値0をとるような0-1変数


目的関数において、いろいろな達成目標が扱えるように、達成目標と目標未達成関数 f 
s
​
  を以下のように定義した 。

S={s∣s は達成したい条件や希望}
f 
s
​
 (x 
ijk
​
 ,i∈M,j∈N,k∈W),s∈S
x 
ijk
​
  の値で与えられる勤務表において達成したい条件sに対する未達成度(達成目標値との差等)に重要度の重み付けしたペナルティを与える関数

《定式化》
(0) Minimize∑ 
s∈S
​
 f 
s
​
 (x 
ijk
​
 ,i∈M,j∈N,k∈W)
s.t.
(1) ∑ 
k∈W
​
 x 
ijk
​
 =1 (i∈M,j∈N)
(2) ∑ 
i∈M
​
 x 
ijk
​
 ≥d 
jk
​
  (j∈N,k∈W)
(3) a 
rjk
​
 ≤∑ 
i∈G 
r
​
 
​
 x 
ijk
​
 ≤b 
rjk
​
  (r∈R,j∈N,k∈W)
(4) c 
ik
​
 ≤∑ 
j∈N
​
 x 
ijk
​
 ≤e 
ik
​
  (i∈M,k∈W)
(5) x 
ijk
​
 =τ ((i,j,k)∈F 
τ
​
 ,τ∈{0,1}) 
(6) ∑ 
α=1
h
​
 x 
i,j+α−1,k 
α
​
 
​
 ≤h−1 (i∈M,j∈{1,...,n−h+1},(k 
1
​
 ,k 
2
​
 ,...,k 
h
​
 )∈P 
h
​
 ,h∈{2,3,...})
(7) u≤∑ 
α=1
h
​
 x 
i,j+α−1,k
​
 ≤v (i∈M,j∈{1,...,n−h+1},(k,u,v)∈Q 
h
​
 ,h∈{2,3,...})
(8) x 
ijk
​
 =0 or 1 (i∈M,j∈N,k∈W)

各式の意味は以下の通りである 。
(0) 目標値との差の合計最小化。
(1) i看護婦のj日の勤務をちょうど1つ割当てる。
(2) j日の勤務kの必要人数を満たす。
(3) j日の勤務kにおけるグループrからの人数が上下限の幅におさまる。
(4) i看護婦の勤務kの数が上下限の幅におさまる。
(5) i看護婦のj日の勤務をkに固定する(τ=1)またはkを禁止する(τ=0)。
(6) j日から連続するh日間に、連続禁止パターンが割り当てられない。
(7) j日から連続するh日間の勤務kの数が上下限の幅におさまる。
(8) x 
ijk
​
  は0-1変数である。

慣れ合いや相性の悪さから夜勤などでの組合せを避ける看護婦に対する条件は、それらの2人または3人以上の看護婦だけで構成されるダミーのグループを設定し、指定された勤務に対するそのグループからの人数の上限を1または適する値にすることで表現することができる 。

また、前月勤務表とのつながりについては、前月末の必要日数分をスケジュール対象日に入れ、「すでに勤務が決定しているもの」として F 
1
​
  で扱うことにより考慮できる 。

  4. モデルのバリエーション
ここで、拘束条件(1)~(8)における変数の係数が0または1であることに着目すると、これらの条件すべては、変数のある部分集合に関して値1を取るものを「足し算」して、その数を制限するものであることがわかる 。この性質は、ヒューリスティック解法等において実行可能性のチェックやコスト計算に利用することができる 。特に(6)式における連続禁止パターンの表現で、拘束条件毎に値1になる変数を数えるカウンターを設定しておけば、勤務列のマッチングをこのカウンターの値判定のみでおこなうことができる 。

これに対し「新人の教育過程において、ある新人看護婦がある勤務に入った場合、決められた指導看護婦がその勤務にいっしょに入らなければいけない」ことが、わずかな期間だが出てくることがあるという 。これは「組合せの強制」となる、つまり「足し算」ではなく「引き算」の拘束条件式を考えなければならない 。具体的には、その看護婦それぞれに対応するグループを設定し、そのグループ間の人数の差を規定する(例えば0) 拘束条件で対応する 。こういった「組合せの強制」の条件は、看護婦に対してだけでなく、ある特定の日についても考えられる 。例えば「土日は連続して休日にする」は、目的関数でなく拘束条件として扱った場合「組合せの強制」となる 。土日のどちらか一方を休日にする場合にはもう一方も休日にしなければいけないと考える 。

これらを一般的に表したものが (9) (10) 式であり、モデルのバリエーションと考える 。

A={(i,J 
1
​
 ,J 
2
​
 ,k 
1
​
 ,k 
2
​
 ,g)∣i∈M,J 
1
​
 ,J 
2
​
 ⊂N,k 
1
​
 ,k 
2
​
 ∈W∣ 看護婦iの J 
1
​
  での勤務が k 
1
​
  になる回数と J 
2
​
  での勤務が k 
2
​
  になる回数との差はg以下}
B={(r 
1
​
 ,r 
2
​
 ,j,k,g)∣r 
1
​
 ,r 
2
​
 ∈R,j∈N,k∈W∣j日の勤務kにおけるグループ r 
1
​
  からの人数とグループ r 
2
​
  からの人数との差はg以下}

として、次のように表現できる 。
(9) ∑ 
j∈J 
1
​
 
​
 x 
ijk 
1
​
 
​
 −∑ 
j∈J 
2
​
 
​
 x 
ijk 
2
​
 
​
 ≤g ((i,J 
1
​
 ,J 
2
​
 ,k 
1
​
 ,k 
2
​
 ,g)∈A)
(10) ∑ 
i∈G 
r 
1
​
 
​
 
​
 x 
ijk
​
 −∑ 
i∈G 
r 
2
​
 
​
 
​
 x 
ijk
​
 ≤g ((r 
1
​
 ,r 
2
​
 ,j,k,g)∈B)

5. 勤務表の作成
今回おこなったモデル化の妥当性を確かめる目的と、アンケートに出てこなかった条件などをあらい出す目的のために、提案するモデルで表される条件を満たすような勤務表作成を試みた 。

拘束条件を規定する具体的な値は、アンケート調査[9]で対象となった病院の婦長と主任との議論から決定し、1995年11月の勤務表を作成した 。

スケジューリング対象看護婦は、患者担当業務面ではAチームとBチームの2グループ、スキル面では1年目の新人と2年目以上のリーダーの2グループに分けられる25人で、勤務体制は3交替である 。日勤、準夜勤、深夜勤の各勤務に対して、全体で必要な人数、AB各チームからの人数や各チーム新人グループとリーダー・グループからの人数の下限と上限を設定した 。そして、各グループに所属する看護婦に対しては、各勤務の1ヶ月分の回数が平準化されるように下限と上限の幅(差)を2に納まるように設定した 。連続禁止パターンとしては、絶対に許されない「深夜勤後の日勤」「深夜勤後の準夜勤」「準夜勤後の日勤」「3連続深夜勤」と、できるだけ許したくない「4連続準夜勤」「5連続準夜勤」「1回だけの孤立深夜勤」「前後が休日となる孤立勤務」を設定した 。そして、後者が勤務表に現れた場合のペナルティを標準とし前者はその2倍になるように設定した 。また回数禁止パターンとしては、「7日間に1回も休日が入らない」「深夜勤と深夜勤の間が8日未満(10日間で3回以上の深夜勤)」「7日間に1回も日勤が入らない」を設定し、標準ペナルティを対応させた 。人数面での過不足については、それぞれ下限や上限からの差をペナルティとした 。具体的には、日勤でリーダーが1人だけ足りなくなる場合には婦長や主任がフォローできることからペナルティを標準に、それ以外の各グループからの過不足については絶対許されないものとしてペナルティを標準の2倍にした 。セミナーや休日希望などすでに固定されている勤務は75ヶ所あり、看護婦組合せ条件は上記グループでの設定以外に個人的組合せをいくつか設定した 。ここでは、モデルの特徴やアルゴリズムについての研究は今後の課題とし、上記目的をはたすための勤務表作成の道具として、シミュレーテッド・アニーリング法を利用した 。初期解は、拘束条件の(1)(2)(5)(8)のみ満たす解、つまり固定されている勤務を考慮しながら毎日の各勤務の人員確保のみを満たすよう表の上の看護婦から順に日勤、準夜勤、深夜勤の必要人数まで勤務を決定し、残りを休日としたものである 。そして、乱数で与えられた「ある日のある看護婦とある看護婦の勤務を交換する、または、しない」といった作業を繰り返すことにした 。目的関数には、土日連休を各看護婦に1回ずつ与えることを目標にすることに加えて、拘束条件(3)(4)(6)(7)を達成しなかった度合いをペナルティとして足し合わせて最小化した 。